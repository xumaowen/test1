clear all;
clc;

%[filename pathname]=uigetfile('*.nii');
dtitk_s1_l1=load_nii('012-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s1_l2=load_nii('012-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s1_l3=load_nii('012-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s1_v1=load_nii('012-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s1_v2=load_nii('012-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s1_v3=load_nii('012-syn2_V3.nii.gz',[],1);



%[filename pathname]=uigetfile('*.nii');
dtitk_s2_l1=load_nii('013-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s2_l2=load_nii('013-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s2_l3=load_nii('013-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s2_v1=load_nii('013-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s2_v2=load_nii('013-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s2_v3=load_nii('013-syn2_V3.nii.gz',[],1);



%[filename pathname]=uigetfile('*.nii');
dtitk_s3_l1=load_nii('034-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s3_l2=load_nii('034-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s3_l3=load_nii('034-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s3_v1=load_nii('034-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s3_v2=load_nii('034-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s3_v3=load_nii('034-syn2_V3.nii.gz',[],1);


%[filename pathname]=uigetfile('*.nii');
dtitk_s4_l1=load_nii('049-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s4_l2=load_nii('049-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s4_l3=load_nii('049-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s4_v1=load_nii('049-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s4_v2=load_nii('049-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s4_v3=load_nii('049-syn2_V3.nii.gz',[],1);




%[filename pathname]=uigetfile('*.nii');
dtitk_s5_l1=load_nii('051-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s5_l2=load_nii('051-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s5_l3=load_nii('051-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s5_v1=load_nii('051-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s5_v2=load_nii('051-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s5_v3=load_nii('051-syn2_V3.nii.gz',[],1);




%[filename pathname]=uigetfile('*.nii');
dtitk_s6_l1=load_nii('052-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s6_l2=load_nii('052-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s6_l3=load_nii('052-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s6_v1=load_nii('052-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s6_v2=load_nii('052-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s6_v3=load_nii('052-syn2_V3.nii.gz',[],1);



%[filename pathname]=uigetfile('*.nii');
dtitk_s7_l1=load_nii('056-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s7_l2=load_nii('056-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s7_l3=load_nii('056-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s7_v1=load_nii('056-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s7_v2=load_nii('056-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s7_v3=load_nii('056-syn2_V3.nii.gz',[],1);




%[filename pathname]=uigetfile('*.nii');
dtitk_s8_l1=load_nii('057-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s8_l2=load_nii('057-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s8_l3=load_nii('057-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s8_v1=load_nii('057-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s8_v2=load_nii('057-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s8_v3=load_nii('057-syn2_V3.nii.gz',[],1);


%[filename pathname]=uigetfile('*.nii');
dtitk_s9_l1=load_nii('059-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s9_l2=load_nii('059-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s9_l3=load_nii('059-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s9_v1=load_nii('059-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s9_v2=load_nii('059-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s9_v3=load_nii('059-syn2_V3.nii.gz',[],1);


%[filename pathname]=uigetfile('*.nii');
dtitk_s10_l1=load_nii('079-syn2_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s10_l2=load_nii('079-syn2_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s10_l3=load_nii('079-syn2_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s10_v1=load_nii('079-syn2_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s10_v2=load_nii('079-syn2_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
dtitk_s10_v3=load_nii('079-syn2_V3.nii.gz',[],1);




%[filename pathname]=uigetfile('*.nii');
template_l1=load_nii('IITmean_tensor_256_L1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
template_l2=load_nii('IITmean_tensor_256_L2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
template_l3=load_nii('IITmean_tensor_256_L3.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
template_v1=load_nii('IITmean_tensor_256_V1.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
template_v2=load_nii('IITmean_tensor_256_V2.nii.gz',[],1);
%[filename pathname]=uigetfile('*.nii');
template_v3=load_nii('IITmean_tensor_256_V3.nii.gz',[],1);

dtitk_s1_ovl=zeros(128,128,64);
dtitk_s2_ovl=zeros(128,128,64);
dtitk_s3_ovl=zeros(128,128,64);
dtitk_s4_ovl=zeros(128,128,64);
dtitk_s5_ovl=zeros(128,128,64);
dtitk_s6_ovl=zeros(128,128,64);
dtitk_s7_ovl=zeros(128,128,64);
dtitk_s8_ovl=zeros(128,128,64);
dtitk_s9_ovl=zeros(128,128,64);
dtitk_s10_ovl=zeros(128,128,64);
dtitk_ovl=zeros(128,128,64);
for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s1_ovl(x,y,z)=(dtitk_s1_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s1_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s1_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s1_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s1_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s1_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s1_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s1_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s1_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end

for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s2_ovl(x,y,z)=(dtitk_s2_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s2_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s2_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s2_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s2_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s2_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s2_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s2_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s2_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end


for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s3_ovl(x,y,z)=(dtitk_s3_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s3_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s3_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s3_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s3_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s3_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s3_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s3_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s3_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end


for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s4_ovl(x,y,z)=(dtitk_s4_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s4_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s4_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s4_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s4_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s4_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s4_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s4_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s4_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end


for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s5_ovl(x,y,z)=(dtitk_s5_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s5_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s5_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s5_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s5_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s5_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s5_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s5_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s5_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end



for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s6_ovl(x,y,z)=(dtitk_s6_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s6_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s6_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s6_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s6_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s6_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s6_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s6_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s6_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end



for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s7_ovl(x,y,z)=(dtitk_s7_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s7_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s7_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s7_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s7_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s7_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s7_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s7_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s7_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end



for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s8_ovl(x,y,z)=(dtitk_s8_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s8_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s8_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s8_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s8_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s8_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s8_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s8_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s8_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end


for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s9_ovl(x,y,z)=(dtitk_s9_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s9_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s9_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s9_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s9_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s9_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s9_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s9_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s9_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end


for x=1:256
    for y=1:256
        for z=1:256
  dtitk_s10_ovl(x,y,z)=(dtitk_s10_l1.img(x,y,z)*template_l1.img(x,y,z)*((dtitk_s10_v1.img(x,y,z)*template_v1.img(x,y,z))^2)+...
    dtitk_s10_l2.img(x,y,z)*template_l2.img(x,y,z)*((dtitk_s10_v2.img(x,y,z)*template_v2.img(x,y,z))^2)+...
    dtitk_s10_l3.img(x,y,z)*template_l3.img(x,y,z)*((dtitk_s10_v3.img(x,y,z)*template_v3.img(x,y,z))^2))/...
    (dtitk_s10_l1.img(x,y,z)*template_l1.img(x,y,z)+dtitk_s10_l2.img(x,y,z)*template_l2.img(x,y,z)+dtitk_s10_l3.img(x,y,z)*template_l3.img(x,y,z));
        end
    end
end

IIT_ovl=(dtitk_s1_ovl+dtitk_s2_ovl+dtitk_s3_ovl+dtitk_s4_ovl+dtitk_s5_ovl+...
    dtitk_s6_ovl+dtitk_s7_ovl+dtitk_s8_ovl+dtitk_s9_ovl+dtitk_s10_ovl)/10;

save IIT_ovl IIT_ovl;



